# 전역상태 관리와 라이브러리

## 리액트에서의 상태

- Props는 컴포넌트간 전달되지만 State는 컴포넌트 안에서 관리되고 시간이 지나면서 바뀌는 동적인 데이터이다.
- 기존 UI의 상태관리는 양방향 데이터 흐름을 가지고 있었기 때문에 컨트롤러의 복잡도가 높았다. 그리고 단방향 흐름을 가지는 리액트가 등장한다.
- 하지만 State를 전달하기 위해 중간에 있는 관계가 없는 중간 컴포넌트까지 지나가면서 State를 Props로 전달하여 Props Drilling이 발생한다.

## 전역 상태는 언제 필요할까?

- 일반적인 경우 상태는 전역 상태보다 관련 컴포넌트에 가까운 지역 상태로서 관리되는게 권장된다.
- Props Drilling과 같은 이슈는 간단하게는 리액트 함수 합성을 이용하여 해결 가능하다.
- **다수의 컴포넌트간에 상태 의존성이 높아진다면 지역 상태로서 관리하기 어려울 수 있다. 또 언어나 다크 모드같은 변화가 잦지 않고 서비스 전반에 걸친 상태면 전역 상태를 이용할 수 있다.**

### 전역 상태의 문제점

- 전역 상태를 이용한다면 전역 State가 바뀔때마다 리렌더링이 일어날 수 있다. 따라서 Redux와 같은 전역 상태의 라이브러리를 꼭 써야하는지 고려해봐야한다.

## 좋은 리액트 상태 관리란?

- State는 관련 컴포넌트들과 최대한 가까이 배치되는게 좋다. 관련없는 컴포넌트의 리렌더링을 방지하기 때문이다.
- 관심사에 따라 분리한다.

## Redux의 한계

- Redux는 안정적인 상태 유지를 위해서 강한 제약을 요구한다. "무엇이 일어나는가"와 "어떻게 바꾸는가"를 분리하기 위해 빙 돌아가는 방식을 추가하는 것이 Redux가 제안하는 요구사항이다.

- 무엇이 일어나는지는 dispatch를 이용해서 알리며 어떻게 부꿀지는 reducer를 이용해서 State를 변경한다.
- **단방향 흐름으로 안정적인 상태운용이 가능하지만 원하는 상태와 기능 추가를 위해서는 dispatch를 위한 action, 상태 변화를 위한 reducer, 컴포넌트에서 state를 가져다 쓰는 부분 모두 손봐야하기 때문에 너무 장황하다는 단점이 있다.**

## 간단한 대안 Context API

- 리액트 Hooks가 등장하면서 비대한 Redux 대신 Context를 활용하는게 권장되고 있다. Context는 수단일 뿐 상태관리 자체는 useState와 useReducer로 하게된다.
- 역할에 맞게 여러 Provider로 쪼개서 관리할 수 있고 또 관련된 컴포넌트들의 상위에 Provider를 감싸면 되기 때문에 전역 상태가 최상단에 위치하는 Redux보다 가까이서 상태를 관리할 수 있게 된다.

### 문제점

- **Redux**는 의존해서 사용하는 값이 변할 때 리렌더링이 되도록 최적화 되어있지만 **Context**의 경우 해당 값말고 다른 값이 변경될 때도 컴포넌트는 재호출되어서 리렌더링이 발생한다. Context를 다룰때에는 꼭 관심사에 따라 모두 다 분리해서 관리해야 한다. 하지만 어플리케이션이 비대할수록 관심사가 많아지면 관리하기 어려울정도로 래핑이 많아지는 문제가 있다. 중첩되는 컴포넌트도 많아지니 성능 이슈 또한 생긴다.

## Recoil

- Recoil은 오직 리액트만을 위해서 생겨난 라이브러리다.
- Recoil을 쓰게되면 Atom이라는 작은 데이터 조각을 만들어서 해당 State 변화시에 이를 참조하는 컴포넌트들만 리렌더를 시키는 단순한 로직으로 되어있다.
