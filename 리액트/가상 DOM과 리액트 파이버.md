## 가상 DOM의 탄생 배경

- 브라우저가 웹페이지를 렌더링하는 과정은 매우 복잡하고 많은 비용이 든다. 빈번한 레이아웃과 리페인팅은 더 많은 비용을 브라우저와 사용자가 지불하게 된다.
- 사용자의 인터랙션에 따라 DOM의 모든 변경 사항을 추적하는 것은 개발자 입장에서 너무나 수고스러운 일이다.
- DOM 계산을 브라우저가 아닌 메모리에서 계산하는 과정을 한 번 더 거치게 된다면 실제로는 여러 번 발생했을 렌더링 과정을 최소화 할 수 있고 브라우저와 개발자의 부담을 덜 수 있다.

## 가상 DOM을 위한 아키텍처, 리액트 파이버

- 리액트 파이버는 가상 DOM과 렌더링 과정 최적화를 가능하게 해준다.

### 리액트 파이버란?

- 리액트 파이버는 리액트에서 관리하는 평범한 **자바스크립트 객체다.**
- 리액트는 컴포넌트 트리에 대한 추가 정보를 포함하기 위해 파이버를 사용한다.
- 파이버는 재조정자가 관리하는데, 가상 DOM과 실제 DOM을 비교해 변경 사항을 수집하며, 만약 이 둘 사이에 차이가 있으면 변경에 관련된 정보를 가지고 있는 파이버를 기준으로 화면에 렌더링을 요청하는 역할을 한다.
- 파이버는 애니매이션과 반응성에 중점을 둔다.
- 리액트 조정자(스택 알고리즘)와 달리 비동기식이다.

> 재조정이란 리액트에서 어떤 부분을 새롭게 렌더링해야 하는지 가상 DOM과 실제 DOM을 비교하는 작업(알고리즘)이라고 이해하면 된다.

재조정자는 FiberNode를 하나의 작업 단위(unitOfWork)로 취급한다. 즉, FiberNode는 자체로 렌더링에 필요한 정보를 담고 있는 객체이자 재조정 작업 단위인 것이다.

### 파이버가 수행하는 일

- 작업을 작은 단위로 분할하고 쪼갠 다음, 우선순위를 매긴다.
- 이러한 작업을 일시 중지하고 나중에 다시 시작할 수 있다.
- 이전에 했던 작업을 다시 재사용하거나 필요하지 않은 경우에는 폐기할 수 있다.

### 파이버는 어떻게 구현돼 있을까?

- 파이버는 하나의 작업 단위로 구성돼 있다.
- 리액트는 이러한 작업 단위를 하나씩 처리하고 finishedWork()라는 작업으로 마무리한다.
- 이 작업을 커밋해 실제 브라우저 DOM에 가시적인 변경 사항을 만들어 낸다.
- 이러한 단계는 아래 두 단계로 나눌 수 있다.
  1. 렌더 단계: 렌더 단계에서 리액트는 사용자에게 노출되지 않는 **모든 비동기 작업을 수행**한다. 그리고 이 단계에서 앞서 언급한 파이버의 작업, 우선 순위를 지정하거나 중지시키거나 버리는 등의 작업이 일어난다.
  2. 커밋 단계: 커밋 단계에서는 앞서 언급한 것처럼 DOM에 실제 변경 사항을 반영하기 위한 작업, commitWork()가 실행되는데, 이 과정은 앞서와 다르게 **동기식**으로 일어나고 중단될 수도 없다.
